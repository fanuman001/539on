<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Julia æ’ç­ ELITE v5.5</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Inter:wght@400;700;900&display=swap');
        :root { 
            --blue: #00d2ff; --red: #ff4757; --green: #2ed573; --gold: #fbc531; 
            --bg: #05070a; --card: #12141c; --border: #1e222e; --gray: #7f8c8d;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #e1e1e1; margin: 0; padding: 12px; padding-bottom: 50px; }
        .card { background: var(--card); padding: 15px; border-radius: 18px; margin-bottom: 12px; border: 1px solid var(--border); }
        
        /* æ™‚æ®µæ¨¡å¡Šæ¨£å¼ */
        .shift-module { display: grid; grid-template-columns: 100px 1fr; gap: 10px; margin-bottom: 15px; background: #000; padding: 12px; border-radius: 12px; border-left: 4px solid var(--blue); }
        .shift-time { font-family: 'JetBrains Mono'; font-size: 12px; color: var(--gold); display: flex; flex-direction: column; justify-content: center; }
        .shift-staff { display: flex; flex-wrap: wrap; gap: 6px; }
        
        /* æ¨™ç±¤æ¨£å¼ */
        .staff-tag { padding: 6px 12px; background: var(--border); border-radius: 8px; font-size: 13px; font-weight: 700; cursor: pointer; border: 1px solid transparent; }
        .staff-tag.active { border-color: var(--blue); color: var(--blue); background: rgba(0, 210, 255, 0.1); }
        
        /* çµ±è¨ˆå€ */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .stat-box { background: #000; padding: 10px; border-radius: 10px; text-align: center; border: 1px solid var(--border); }
        .stat-val { font-family: 'JetBrains Mono'; font-size: 18px; color: var(--green); display: block; }
        
        .input-group { margin-top: 10px; display: flex; gap: 5px; }
        input, select { flex: 1; background: #000; border: 1px solid var(--border); color: #fff; padding: 8px; border-radius: 8px; font-size: 12px; }
        .btn { padding: 10px 15px; border-radius: 8px; border: none; font-weight: 900; cursor: pointer; }
        .btn-save { background: var(--green); color: #000; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <b style="color:var(--gray); font-size:12px;">âš–ï¸ ç´¯è¨ˆç¸½æ™‚æ•¸ (å…¬å¹³æ€§æª¢æ ¸)</b>
        <div class="stats-grid" id="statsArea" style="margin-top:10px;">
            <div class="stat-box"><span class="stat-label">Ora</span><span id="total-Ora" class="stat-val">0</span></div>
            <div class="stat-box"><span class="stat-label">Eva</span><span id="total-Eva" class="stat-val">0</span></div>
            <div class="stat-box"><span class="stat-label">James</span><span id="total-James" class="stat-val">0</span></div>
        </div>
    </div>

    <div id="shift-container">
        </div>

    <div class="card">
        <b style="color:var(--gold); font-size:13px;">ğŸ“ ä»Šæ—¥çµç­å·¥æ™‚éŒ„å…¥</b>
        <div class="input-group">
            <select id="staffSelect">
                <option value="Ora">Ora</option>
                <option value="Eva">Eva</option>
                <option value="James">James</option>
            </select>
            <input type="number" id="actualHours" placeholder="å¡«å¯«å¯¦éš›ç¸½å·¥æ™‚">
        </div>
        <button class="btn btn-save" onclick="submitWork()">ç¢ºèªæäº¤ä¸¦æ›´æ–°çµ±è¨ˆ</button>
    </div>

<script>
    const SUPABASE_URL = 'https://nzuxyiefpenwuqudajdw.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_7y2n8zIopxlKEhcsJ05D2A_U89IFgae';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // æ¨¡å¡ŠåŒ–æ™‚æ®µé…ç½®
    const shiftConfig = [
        { id: 'm1', label: 'æ—©ç­', time: '08:00-13:00', defaultHrs: 5 },
        { id: 'm2', label: 'ä¸­ç­', time: '13:00-18:00', defaultHrs: 5 },
        { id: 'm3', label: 'å°–å³°', time: '18:00-20:00', defaultHrs: 2, note: '3äººæ”¯æ´' },
        { id: 'm4', label: 'æ™šç­', time: '20:00-24:00', defaultHrs: 4, note: 'å¯ææ—©' }
    ];

    let currentSchedule = {}; // å­˜æ”¾ä»Šæ—¥è‡¨æ™‚æŒ‡æ´¾

    async function init() {
        renderShifts();
        await loadStats();
    }

    function renderShifts() {
        const container = document.getElementById('shift-container');
        container.innerHTML = shiftConfig.map(s => `
            <div class="shift-module">
                <div class="shift-time">
                    <b>${s.label}</b>
                    <span>${s.time}</span>
                </div>
                <div class="shift-staff">
                    ${['Ora', 'Eva', 'James'].map(name => `
                        <div class="staff-tag ${currentSchedule[s.id]?.includes(name) ? 'active' : ''}" 
                             onclick="toggleStaff('${s.id}', '${name}')">
                            ${name}
                        </div>
                    `).join('')}
                </div>
            </div>
        `).join('');
    }

    function toggleStaff(shiftId, name) {
        if (!currentSchedule[shiftId]) currentSchedule[shiftId] = [];
        const index = currentSchedule[shiftId].indexOf(name);
        if (index > -1) {
            currentSchedule[shiftId].splice(index, 1);
        } else {
            currentSchedule[shiftId].push(name);
        }
        renderShifts();
    }

    async function loadStats() {
        const { data } = await supabaseClient.from('work_logs').select('name, duration');
        const totals = { Ora: 0, Eva: 0, James: 0 };
        data?.forEach(d => { if(totals[d.name] !== undefined) totals[d.name] += d.duration; });
        
        for (let name in totals) {
            document.getElementById(`total-${name}`).innerText = totals[name].toFixed(1);
        }
    }

    async function submitWork() {
        const name = document.getElementById('staffSelect').value;
        const hrs = parseFloat(document.getElementById('actualHours').value);
        if (isNaN(hrs)) return alert("è«‹è¼¸å…¥æ­£ç¢ºå·¥æ™‚");

        const { error } = await supabaseClient.from('work_logs').insert([
            { name: name, duration: hrs, note: 'æ¨¡å¡ŠåŒ–çµç­æäº¤' }
        ]);

        if (!error) {
            alert(`${name} çš„ ${hrs} å°æ™‚å·¥æ™‚å·²ç´¯è¨ˆ`);
            document.getElementById('actualHours').value = '';
            loadStats();
        }
    }

    init();
</script>
</body>
</html>

