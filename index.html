<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½©åˆ¸è¡Œå·¥æ™‚ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; max-width: 600px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2, h3 { color: #d32f2f; text-align: center; }
        select, button, input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; }
        button { background: #d32f2f; color: white; border: none; cursor: pointer; font-weight: bold; }
        button.secondary { background: #0288d1; }
        .stats { display: flex; justify-content: space-between; background: #eee; padding: 10px; border-radius: 8px; font-size: 14px; }
        .status-on { color: #2e7d32; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

    <h2>ğŸ§§ å½©åˆ¸è¡Œå·¥æ™‚ç³»çµ±</h2>
    
    <div class="card">
        <h3>èº«åˆ†ç™»å…¥</h3>
        <select id="userSelect">
            <option value="">-- æˆ‘æ˜¯èª°ï¼Ÿ --</option>
            <option value="Ora">å§Šå§Š Ora (B)</option>
            <option value="Eva">å§Šå§Š Eva (C)</option>
            <option value="James">æˆ‘ James (D)</option>
        </select>
        <p id="currentUserDisplay" class="status-on"></p>
    </div>

    <div class="card">
        <h3>å¯¦æ™‚æ‰“å¡</h3>
        <button onclick="handleClockIn()">ç¾åœ¨ä¸Šç­</button>
        <button class="secondary" onclick="handleClockOut()">ç¾åœ¨ä¸‹ç­</button>
        <p id="shiftStatus"></p>
    </div>

    <div class="card">
        <h3>è‡¨æ™‚ä»£ç­è¨˜éŒ„</h3>
        <label>åŸå®šèª°ä¸Šç­ï¼Ÿ</label>
        <select id="originalPerson">
            <option value="Ora">Ora</option>
            <option value="Eva">Eva</option>
            <option value="James">James</option>
        </select>
        <label>ä»£ç­æ™‚æ•¸ (å°æ™‚)</label>
        <input type="number" id="manualHours" placeholder="ä¾‹å¦‚ï¼š2.5">
        <button onclick="handleManualLog()">æäº¤ä»£ç­å·¥æ™‚</button>
    </div>

    <div class="card">
        <h3>å·¥æ™‚ç´¯è¨ˆ (å…¬å¹³æ€§æª¢æŸ¥)</h3>
        <div id="statsArea">è¼‰å…¥ä¸­...</div>
    </div>

    <script>
        // --- Supabase è¨­å®š (è«‹æ›¿æ›æˆä½ çš„ URL å’Œ Key) ---
        const SUPABASE_URL = 'ä½ çš„_SUPABASE_URL';
        const SUPABASE_KEY = 'ä½ çš„_SUPABASE_ANON_KEY';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let startTime = null;

        // æ›´æ–°ç•¶å‰ä½¿ç”¨è€…
        document.getElementById('userSelect').onchange = function() {
            const user = this.value;
            document.getElementById('currentUserDisplay').innerText = user ? `ç•¶å‰ä½¿ç”¨è€…ï¼š${user}` : "";
            loadStats();
        };

        // æ‰“å¡ä¸Šç­
        async function handleClockIn() {
            const user = document.getElementById('userSelect').value;
            if (!user) return alert("è«‹å…ˆé¸èº«åˆ†ï¼");
            startTime = new Date();
            document.getElementById('shiftStatus').innerText = `å·²æ–¼ ${startTime.toLocaleTimeString()} ä¸Šç­æ‰“å¡`;
        }

        // æ‰“å¡ä¸‹ç­ä¸¦å¯«å…¥è³‡æ–™åº«
        async function handleClockOut() {
            const user = document.getElementById('userSelect').value;
            if (!startTime) return alert("å°šæœªæ‰“å¡ä¸Šç­ï¼");
            
            const endTime = new Date();
            const duration = (endTime - startTime) / (1000 * 60 * 60); // è½‰å°æ™‚

            const { error } = await supabase.from('work_logs').insert([
                { name: user, start_time: startTime, end_time: endTime, duration: duration }
            ]);

            if (error) alert("å¯«å…¥å¤±æ•—: " + error.message);
            else {
                alert(`è¾›è‹¦äº†ï¼æœ¬æ¬¡å·¥ä½œ ${duration.toFixed(2)} å°æ™‚`);
                startTime = null;
                document.getElementById('shiftStatus').innerText = "";
                loadStats();
            }
        }

        // æ‰‹å‹•æäº¤ä»£ç­å·¥æ™‚ (ä¾‹å¦‚ James å¹« Ora ç«™äº† 2 å°æ™‚)
        async function handleManualLog() {
            const realWorker = document.getElementById('userSelect').value;
            const hours = parseFloat(document.getElementById('manualHours').value);
            if (!realWorker || !hours) return alert("è«‹ç¢ºèªèº«åˆ†èˆ‡æ™‚æ•¸");

            const { error } = await supabase.from('work_logs').insert([
                { name: realWorker, duration: hours, note: "ä»£ç­è¨˜éŒ„" }
            ]);

            if (!error) {
                alert("ä»£ç­å·¥æ™‚å·²ç´¯è¨ˆï¼");
                loadStats();
            }
        }

        // å¾è³‡æ–™åº«æŠ“å–ç´¯è¨ˆæ™‚æ•¸
        async function loadStats() {
            const { data, error } = await supabase.from('work_logs').select('name, duration');
            if (error) return;

            const summary = { Ora: 0, Eva: 0, James: 0 };
            data.forEach(log => {
                if (summary[log.name] !== undefined) summary[log.name] += log.duration;
            });

            document.getElementById('statsArea').innerHTML = `
                <div class="stats"><span>Ora (B):</span> <b>${summary.Ora.toFixed(1)} hrs</b></div>
                <div class="stats"><span>Eva (C):</span> <b>${summary.Eva.toFixed(1)} hrs</b></div>
                <div class="stats"><span>James (D):</span> <b>${summary.James.toFixed(1)} hrs</b></div>
            `;
        }

        loadStats(); // åˆå§‹åŒ–è¼‰å…¥
    </script>
</body>
</html>
