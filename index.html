<script>
    const SUPABASE_URL = '你的_URL';
    const SUPABASE_KEY = '你的_KEY';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function loadSchedule() {
        const area = document.getElementById('scheduleArea');
        try {
            // 測試連線
            const { data: base, error: baseError } = await supabase.from('base_schedule').select('*').order('work_date');
            
            if (baseError) {
                area.innerHTML = `<p style="color:red">讀取失敗：${baseError.message}</p>`;
                return;
            }

            if (!base || base.length === 0) {
                area.innerHTML = `<p style="color:orange">資料庫裡沒有班表資料，請確認 SQL 是否執行成功。</p>`;
                return;
            }

            const { data: swaps } = await supabase.from('swap_logs').select('*');

            let html = '<table><tr><th>日期</th><th>早班</th><th>晚班</th></tr>';
            base.forEach(b => {
                let daySwaps = swaps ? swaps.filter(s => s.work_date === b.work_date) : [];
                
                // 早班邏輯
                let mShift = b.morning_shift;
                let mSwap = daySwaps.find(s => s.original_owner === mShift);
                let mDisplay = mSwap ? `<span class="original">${mShift}</span> → <b style="color:blue">${mSwap.new_name}</b>` : mShift;

                // 晚班邏輯
                let eDisplay = b.evening_shift.map(p => {
                    let eSwap = daySwaps.find(s => s.original_owner === p);
                    return eSwap ? `<span class="original">${p}</span> → <b style="color:blue">${eSwap.new_name}</b>` : p;
                }).join(' / ');

                html += `<tr><td>${b.work_date.split('-')[1]}/${b.work_date.split('-')[2]}</td><td>Julia+${mDisplay}</td><td>${eDisplay}</td></tr>`;
            });
            html += '</table>';
            area.innerHTML = html;
        } catch (err) {
            area.innerHTML = `<p style="color:red">程式執行出錯：${err.message}</p>`;
        }
    }
    loadSchedule();
</script>
